<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ToyLAND</title>
  <style>
    body { display:flex; }
    #mapCanvas { border:1px solid black; cursor:crosshair; }
    #panel { margin-left:20px; }
  </style>
</head>
<body>
  <canvas id="mapCanvas" width="800" height="600"></canvas>

  <div id="panel">
    <h2>国家情報</h2>
    <label>国名: <input id="nationName" value="プレイヤー国家"></label><br>
    <label>主義: 
      <select id="ideology">
        <option>民主主義</option>
        <option>共産主義</option>
        <option>独裁</option>
      </select>
    </label><br>
    <label>通貨: <input id="currency" value="ToyCoin"></label><br>
    <label>色: <input type="color" id="colorPicker" value="#ff0000"></label><br>
    <button onclick="saveGame()">セーブ</button>
    <button onclick="loadGame()">ロード</button>
  </div>

  <script>
    const canvas = document.getElementById("mapCanvas");
    const ctx = canvas.getContext("2d");
    const img = new Image();
    img.src = "https://kyouyuuno-to.f5.si/img/0001.png"; // PNGでもSVGでもOK

    img.onload = () => ctx.drawImage(img,0,0,canvas.width,canvas.height);

    // Flood fill（バケツ塗り）
    function floodFill(x, y, fillColor) {
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;

      function getPixel(x, y) {
        const i = (y * canvas.width + x) * 4;
        return [data[i], data[i+1], data[i+2], data[i+3]];
      }
      function setPixel(x, y, color) {
        const i = (y * canvas.width + x) * 4;
        data[i] = color[0];
        data[i+1] = color[1];
        data[i+2] = color[2];
        data[i+3] = 255;
      }
      function colorsMatch(c1, c2) {
        return c1[0]===c2[0] && c1[1]===c2[1] && c1[2]===c2[2] && c1[3]===c2[3];
      }
      function isBorder(c) {
        // 灰色 or 黒なら壁扱い
        return (c[0]===128 && c[1]===128 && c[2]===128) || 
               (c[0]===0 && c[1]===0 && c[2]===0);
      }

      const startColor = getPixel(x, y);
      if (isBorder(startColor)) return;

      const targetColor = fillColor.match(/\w\w/g).map(v=>parseInt(v,16));
      targetColor.push(255);

      const stack = [[x,y]];
      while (stack.length) {
        const [cx, cy] = stack.pop();
        if (cx<0 || cy<0 || cx>=canvas.width || cy>=canvas.height) continue;
        const c = getPixel(cx, cy);
        if (isBorder(c) || colorsMatch(c, targetColor)) continue;

        setPixel(cx, cy, targetColor);
        stack.push([cx+1,cy],[cx-1,cy],[cx,cy+1],[cx,cy-1]);
      }

      ctx.putImageData(imageData, 0, 0);
    }

    // クリックで塗る
    canvas.addEventListener("click", e=>{
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor(e.clientX - rect.left);
      const y = Math.floor(e.clientY - rect.top);
      const fillColor = document.getElementById("colorPicker").value;
      floodFill(x, y, fillColor);
    });

    // 簡易セーブ/ロード
    function saveGame(){
      const state = {
        nation: document.getElementById("nationName").value,
        ideology: document.getElementById("ideology").value,
        currency: document.getElementById("currency").value
      };
      localStorage.setItem("saveData", JSON.stringify(state));
      alert("セーブしました");
    }
    function loadGame(){
      const state = JSON.parse(localStorage.getItem("saveData")||"{}");
      if(state.nation) document.getElementById("nationName").value = state.nation;
      if(state.ideology) document.getElementById("ideology").value = state.ideology;
      if(state.currency) document.getElementById("currency").value = state.currency;
      alert("ロードしました");
    }
  </script>
</body>
</html>
