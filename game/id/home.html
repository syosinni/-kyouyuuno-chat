<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>世界ステートマップ</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
    }
    #canvasContainer {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #87CEFA; /* 海の色 */
      position: relative;
    }
    canvas {
      display: block;
      cursor: pointer;
      image-rendering: pixelated;
    }
  </style>
</head>
<body>
<div id="canvasContainer">
  <canvas id="mapCanvas"></canvas>
</div>

<script>
const imageSrc = "https://kyouyuuno-to.f5.si/img/0001.png";

const canvas = document.getElementById('mapCanvas');
const ctx = canvas.getContext('2d');
let scale = 1;
let offsetX = 0;
let offsetY = 0;
let dragging = false;
let dragStart = { x: 0, y: 0 };
let selectedRegions = [];

const img = new Image();
img.crossOrigin = "anonymous";
img.src = imageSrc;

img.onload = () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  draw();
};

function draw() {
  ctx.setTransform(scale, 0, 0, scale, offsetX, offsetY);
  ctx.clearRect(-offsetX/scale, -offsetY/scale, canvas.width/scale, canvas.height/scale);
  ctx.drawImage(img, 0, 0);

  // 塗りつぶしステートを赤で表示
  for (const pixel of selectedRegions) {
    ctx.fillStyle = "rgba(255,0,0,0.5)";
    ctx.fillRect(pixel.x, pixel.y, 1, 1);
  }
}

// クリック位置を確認して白ピクセルか判定
canvas.addEventListener('click', (e) => {
  const rect = canvas.getBoundingClientRect();
  const x = (e.clientX - rect.left - offsetX) / scale;
  const y = (e.clientY - rect.top - offsetY) / scale;

  const tempCanvas = document.createElement('canvas');
  tempCanvas.width = img.width;
  tempCanvas.height = img.height;
  const tempCtx = tempCanvas.getContext('2d');
  tempCtx.drawImage(img, 0, 0);
  const imageData = tempCtx.getImageData(x, y, 1, 1).data;

  // RGBが(255,255,255)なら白 = ステート
  if (imageData[0] === 255 && imageData[1] === 255 && imageData[2] === 255) {
    selectedRegions.push({ x: Math.floor(x), y: Math.floor(y) });
    draw();
  }
});

// ズーム処理（ホイール）
canvas.addEventListener('wheel', (e) => {
  e.preventDefault();
  const zoom = e.deltaY < 0 ? 1.1 : 0.9;
  const mouseX = e.offsetX;
  const mouseY = e.offsetY;

  offsetX = mouseX - (mouseX - offsetX) * zoom;
  offsetY = mouseY - (mouseY - offsetY) * zoom;
  scale *= zoom;
  draw();
});

// ドラッグ移動
canvas.addEventListener('mousedown', (e) => {
  dragging = true;
  dragStart = { x: e.clientX, y: e.clientY };
});

canvas.addEventListener('mousemove', (e) => {
  if (dragging) {
    offsetX += e.clientX - dragStart.x;
    offsetY += e.clientY - dragStart.y;
    dragStart = { x: e.clientX, y: e.clientY };
    draw();
  }
});

canvas.addEventListener('mouseup', () => dragging = false);
canvas.addEventListener('mouseleave', () => dragging = false);
</script>
</body>
</html>
