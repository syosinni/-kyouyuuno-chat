<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SVGバケツ塗り</title>
<style>
  canvas { border: 1px solid #000; cursor: crosshair; display: block; margin: 20px auto; }
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
const svgUrl = "https://kyouyuuno-to.f5.si/img/0001.svg";
const fillColor = {r:255, g:0, b:0, a:255}; // 塗りたい色 RGBA
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

// SVGを画像に変換して描画
const img = new Image();
img.crossOrigin = "anonymous";
img.onload = () => {
    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img, 0, 0);
}
img.src = svgUrl;

// バケツ塗り関数（4方向で広がるFlood Fill）
function floodFill(x, y) {
    const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const data = imgData.data;

    const width = canvas.width;
    const height = canvas.height;

    const idx = (x + y*width)*4;
    const targetColor = [data[idx], data[idx+1], data[idx+2], data[idx+3]];

    // すでに塗る色なら終了
    if(targetColor[0]===fillColor.r && targetColor[1]===fillColor.g && targetColor[2]===fillColor.b) return;

    const stack = [[x,y]];
    while(stack.length){
        const [cx,cy] = stack.pop();
        const i = (cx + cy*width)*4;
        const c = [data[i], data[i+1], data[i+2], data[i+3]];

        // 白(#ffffff)のみ塗る
        if(c[0]===255 && c[1]===255 && c[2]===255){
            data[i] = fillColor.r;
            data[i+1] = fillColor.g;
            data[i+2] = fillColor.b;
            data[i+3] = fillColor.a;

            if(cx>0) stack.push([cx-1,cy]);
            if(cx<width-1) stack.push([cx+1,cy]);
            if(cy>0) stack.push([cx,cy-1]);
            if(cy<height-1) stack.push([cx,cy+1]);
        }
    }
    ctx.putImageData(imgData,0,0);
}

// クリックでバケツ塗り
canvas.addEventListener('click', e => {
    const rect = canvas.getBoundingClientRect();
    const x = Math.floor((e.clientX - rect.left)*(canvas.width/rect.width));
    const y = Math.floor((e.clientY - rect.top)*(canvas.height/rect.height));
    floodFill(x,y);
});
</script>

</body>
</html>
