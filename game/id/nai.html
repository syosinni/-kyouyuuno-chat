<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>国家管理＋議会＋イベントシステム</title>
  <style>
    body { font-family: sans-serif; background: #f5f5f5; padding: 20px; }
    h2 { margin-top: 30px; }
    button { margin: 5px; }
    textarea { width: 100%; height: 100px; }
    #event-log { background: #fff; border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: scroll; }
  </style>
</head>
<body>

  <h1>国家管理シミュレーション</h1>
  <p>現在の年月: <span id="year">1961</span>年 <span id="month">1</span>月</p>
  <button onclick="advanceMonth()">1か月進める</button>
  <button onclick="forceEvent()">イベント強制発生</button>

  <h2>人口と税率</h2>
  人口: <input type="number" id="population" value="50000000"><br>
  所得税: <input type="number" id="tax_income" value="10">%　
  法人税: <input type="number" id="tax_corp" value="20">%　
  消費税: <input type="number" id="tax_consume" value="5">%　
  資産税: <input type="number" id="tax_asset" value="2">%　
  輸出税: <input type="number" id="tax_export" value="3">%　
  輸入税: <input type="number" id="tax_import" value="3">%　
  <p>年間税収: <span id="revenue">0</span> 円</p>

  <h2>国家予算と国債</h2>
  国家予算: <input type="number" id="budget" value="100000000000"> 円<br>
  国債残高: <span id="debt">0</span> 円
  <button onclick="issueDebt()">国債発行</button>

  <h2>省庁と内閣</h2>
  <div id="cabinet"></div>

  <h2>イベント</h2>
  <div id="event-log"></div>

  <h2>保存/読み込み</h2>
  <button onclick="saveJSON()">JSON保存</button>
  <input type="file" id="loadFile" onchange="loadJSON(event)">

  <script>
    let year = 1961, month = 1;
    let debt = 0;
    let events = []; // イベントデータ
    let currentEvent = null;

    const eventList = [
      {cat:"経済",title:"経済の衰退",choices:[
        {text:"金融緩和",effect:()=>{addLog("金融緩和実施");}},
        {text:"緊縮財政",effect:()=>{addLog("緊縮財政を実施");}},
        {text:"企業救済",effect:()=>{addLog("企業救済を行った");}}
      ]},
      {cat:"軍事",title:"国境で戦闘",choices:[
        {text:"軍を派遣",effect:()=>{addLog("軍を派遣した");}},
        {text:"外交解決",effect:()=>{addLog("外交解決を模索");}},
        {text:"無視",effect:()=>{addLog("国境の問題を無視");}}
      ]},
      // ここに98個のイベントを用意（カテゴリ＋選択肢）
    ];
    while(eventList.length<100){
      eventList.push({cat:"汎用",title:"ランダムイベント"+eventList.length,choices:[
        {text:"選択肢A",effect:()=>{addLog("Aを選んだ");}},
        {text:"選択肢B",effect:()=>{addLog("Bを選んだ");}},
        {text:"選択肢C",effect:()=>{addLog("Cを選んだ");}}
      ]});
    }

    function advanceMonth(){
      month++;
      if(month>12){month=1;year++;}
      document.getElementById("year").textContent=year;
      document.getElementById("month").textContent=month;
      if(Math.random()<0.3){ triggerEvent(); }
      updateRevenue();
    }

    function triggerEvent(){
      currentEvent = eventList[Math.floor(Math.random()*eventList.length)];
      let log = `[${currentEvent.cat}] ${currentEvent.title}\n`;
      currentEvent.choices.forEach((c,i)=>log+=`${i+1}. ${c.text}\n`);
      addLog(log);
    }

    function forceEvent(){ triggerEvent(); }

    function addLog(msg){
      document.getElementById("event-log").textContent += msg + "\n\n";
    }

    function updateRevenue(){
      let pop = parseInt(document.getElementById("population").value);
      let totalTax = parseFloat(document.getElementById("tax_income").value) + 
                     parseFloat(document.getElementById("tax_corp").value) + 
                     parseFloat(document.getElementById("tax_consume").value) +
                     parseFloat(document.getElementById("tax_asset").value) +
                     parseFloat(document.getElementById("tax_export").value) +
                     parseFloat(document.getElementById("tax_import").value);
      let rev = pop * totalTax * 10; 
      document.getElementById("revenue").textContent = rev.toLocaleString();
    }

    function issueDebt(){
      debt += 10000000000;
      document.getElementById("debt").textContent = debt.toLocaleString();
    }

    function saveJSON(){
      const data = {
        year,month,debt,
        population:document.getElementById("population").value,
        taxes:{
          income:document.getElementById("tax_income").value,
          corp:document.getElementById("tax_corp").value,
          consume:document.getElementById("tax_consume").value,
          asset:document.getElementById("tax_asset").value,
          export:document.getElementById("tax_export").value,
          import:document.getElementById("tax_import").value
        }
      };
      const blob = new Blob([JSON.stringify(data)],{type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "nation.json";
      a.click();
    }

    function loadJSON(evt){
      const file = evt.target.files[0];
      const reader = new FileReader();
      reader.onload = function(e){
        const data = JSON.parse(e.target.result);
        year = data.year; month = data.month; debt = data.debt;
        document.getElementById("population").value = data.population;
        document.getElementById("tax_income").value = data.taxes.income;
        document.getElementById("tax_corp").value = data.taxes.corp;
        document.getElementById("tax_consume").value = data.taxes.consume;
        document.getElementById("tax_asset").value = data.taxes.asset;
        document.getElementById("tax_export").value = data.taxes.export;
        document.getElementById("tax_import").value = data.taxes.import;
        document.getElementById("year").textContent=year;
        document.getElementById("month").textContent=month;
        document.getElementById("debt").textContent=debt.toLocaleString();
        updateRevenue();
      };
      reader.readAsText(file);
    }

    updateRevenue();
  </script>
</body>
</html>
