<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>æ”»æ’ƒé˜²è¡›æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ |å…±æœ‰ãƒãƒ¼ãƒˆ</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background:#f0f0f0; }
  h1 { text-align:center; }
  .tab {
    display: inline-block; padding: 10px 20px; cursor: pointer;
    background: #ddd; margin-right: 5px; border-radius: 5px 5px 0 0;
    user-select:none;
  }
  .tab.active { background: white; border-bottom: 2px solid white; font-weight: bold; }
  .container { background: white; padding: 15px; border-radius: 0 5px 5px 5px; box-shadow: 0 3px 8px rgba(0,0,0,0.2); }
  .battle-section { display: flex; gap: 20px; margin-top: 10px; }
  .side {
    flex: 1; border: 1px solid #ccc; padding: 10px; border-radius: 5px; background:#fafafa;
  }
  .side h3 { margin-top: 0; }
  .unit-row {
    display: flex; gap: 8px; margin-bottom: 6px; align-items:center;
  }
  select, input[type=number] { padding: 4px; font-size: 14px; width: 130px; }
  input[type=number] { width: 60px; }
  button.add-unit, button.remove-unit, button.fight-btn {
    cursor: pointer; padding: 5px 10px; font-size: 14px; border:none; border-radius: 3px;
  }
  button.add-unit { background: #4caf50; color: white; }
  button.remove-unit { background: #e74c3c; color: white; }
  button.fight-btn { background: #007bff; color: white; margin-top: 10px; width: 100%; }
  #result {
    margin-top: 15px; padding: 10px; background: #222; color: #fff; white-space: pre-wrap; border-radius: 5px; min-height: 140px; font-family: monospace;
  }
</style>
</head>
<body>

<h1>æ”»æ’ƒé˜²è¡›æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ ï½œå…±æœ‰ãƒãƒ¼ãƒˆ</h1>

<div>
  <div id="tabs">
    <div class="tab active" data-tab="land">é™¸æˆ¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</div>
    <div class="tab" data-tab="sea">æµ·æˆ¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</div>
    <div class="tab" data-tab="air">ç©ºæˆ¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</div>
  </div>

  <!-- é™¸æˆ¦ -->
  <div id="land" class="container tab-content">
    <div class="battle-section">
      <div class="side" id="land-attacker">
        <h3>æ”»æ’ƒå´ï¼ˆé™¸æˆ¦å¸«å›£ï¼‰</h3>
        <div class="units-list"></div>
        <button class="add-unit">å¸«å›£è¿½åŠ </button>
      </div>
      <div class="side" id="land-defender">
        <h3>é˜²è¡›å´ï¼ˆé™¸æˆ¦å¸«å›£ï¼‰</h3>
        <div class="units-list"></div>
        <button class="add-unit">å¸«å›£è¿½åŠ </button>
      </div>
    </div>
    <button class="fight-btn" onclick="simulateBattle('land')">æˆ¦é—˜é–‹å§‹</button>
    <pre id="result-land" class="result"></pre>
  </div>

  <!-- æµ·æˆ¦ -->
  <div id="sea" class="container tab-content" style="display:none;">
    <div class="battle-section">
      <div class="side" id="sea-attacker">
        <h3>æ”»æ’ƒå´ï¼ˆæµ·è»è‰¦éšŠï¼‰</h3>
        <div class="units-list"></div>
        <button class="add-unit">è‰¦éšŠè¿½åŠ </button>
      </div>
      <div class="side" id="sea-defender">
        <h3>é˜²è¡›å´ï¼ˆæµ·è»è‰¦éšŠï¼‰</h3>
        <div class="units-list"></div>
        <button class="add-unit">è‰¦éšŠè¿½åŠ </button>
      </div>
    </div>
    <button class="fight-btn" onclick="simulateBattle('sea')">æˆ¦é—˜é–‹å§‹</button>
    <pre id="result-sea" class="result"></pre>
  </div>

  <!-- ç©ºæˆ¦ -->
  <div id="air" class="container tab-content" style="display:none;">
    <div class="battle-section">
      <div class="side" id="air-attacker">
        <h3>æ”»æ’ƒå´ï¼ˆèˆªç©ºéƒ¨éšŠï¼‰</h3>
        <div class="units-list"></div>
        <button class="add-unit">éƒ¨éšŠè¿½åŠ </button>
      </div>
      <div class="side" id="air-defender">
        <h3>é˜²è¡›å´ï¼ˆèˆªç©ºéƒ¨éšŠï¼‰</h3>
        <div class="units-list"></div>
        <button class="add-unit">éƒ¨éšŠè¿½åŠ </button>
      </div>
    </div>
    <button class="fight-btn" onclick="simulateBattle('air')">æˆ¦é—˜é–‹å§‹</button>
    <pre id="result-air" class="result"></pre>
  </div>
</div>

<script>
(() => {
  // ãƒ¦ãƒ‹ãƒƒãƒˆå®šç¾©
  const unitsData = {
    land: {
      infantry: { name: 'æ­©å…µ', attack: 30, defense: 30 },
      tank: { name: 'æˆ¦è»Š', attack: 70, defense: 60 },
      mech: { name: 'æ­©å…µæˆ¦è»Š', attack: 50, defense: 40 },
      marine: { name: 'æµ·å…µéšŠ', attack: 40, defense: 35 },
      airborne: { name: 'ç©ºæŒºå›£', attack: 45, defense: 35 },
      mountain: { name: 'å±±å²³å…µ', attack: 35, defense: 40 },
      heavy: { name: 'é‡è£…å‚™å…µ', attack: 60, defense: 70 },
      heli: { name: 'ãƒ˜ãƒªéƒ¨éšŠ', attack: 55, defense: 40 },
    },
    sea: {
      destroyer: { name: 'é§†é€è‰¦', attack: 55, defense: 50 },
      light_cruiser: { name: 'è»½å·¡æ´‹è‰¦', attack: 65, defense: 55 },
      heavy_cruiser: { name: 'é‡å·¡æ´‹è‰¦', attack: 80, defense: 70 },
      battleship: { name: 'æˆ¦è‰¦', attack: 100, defense: 90 },
      missile_ship: { name: 'ãƒŸã‚µã‚¤ãƒ«è‰¦', attack: 85, defense: 60 },
      aegis: { name: 'ã‚¤ãƒ¼ã‚¸ã‚¹è‰¦', attack: 70, defense: 75 },
      transport: { name: 'è¼¸é€è‰¦', attack: 10, defense: 30 },
      landing_ship: { name: 'å¼·è¥²ä¸Šé™¸è‰¦', attack: 40, defense: 50 },
      aircraft_carrier: { name: 'ç©ºæ¯', attack: 110, defense: 80 },
    },
    air: {
      fighter: { name: 'æˆ¦é—˜æ©Ÿ', attack: 90, defense: 50 },
      bomber: { name: 'çˆ†æ’ƒæ©Ÿ', attack: 110, defense: 40 },
      helicopter: { name: 'ãƒ˜ãƒªã‚³ãƒ—ã‚¿ãƒ¼', attack: 50, defense: 45 },
      transport_aircraft: { name: 'è¼¸é€æ©Ÿ', attack: 20, defense: 60 },
    }
  };

  // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
  const tabs = document.querySelectorAll('.tab');
  const tabContents = document.querySelectorAll('.tab-content');
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      tabContents.forEach(c => {
        c.style.display = (c.id === tab.dataset.tab) ? 'block' : 'none';
      });
    });
  });

  // ãƒ¦ãƒ‹ãƒƒãƒˆè¡Œä½œæˆ
  function createUnitRow(type, selectedKey = null, count = 1) {
    const div = document.createElement('div');
    div.className = 'unit-row';

    const select = document.createElement('select');
    Object.entries(unitsData[type]).forEach(([key, data]) => {
      const opt = document.createElement('option');
      opt.value = key;
      opt.textContent = data.name;
      if (key === selectedKey) opt.selected = true;
      select.appendChild(opt);
    });

    const input = document.createElement('input');
    input.type = 'number';
    input.min = 1;
    input.value = count;

    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'remove-unit';
    btn.textContent = 'å‰Šé™¤';
    btn.onclick = () => div.remove();

    div.appendChild(select);
    div.appendChild(input);
    div.appendChild(btn);

    return div;
  }

  // åˆæœŸè¡Œè¿½åŠ 
  function addInitialUnits(sideElem, type) {
    sideElem.querySelector('.units-list').appendChild(createUnitRow(type));
  }

  // ã€Œå¸«å›£è¿½åŠ ã€ãƒœã‚¿ãƒ³å‡¦ç†
  document.querySelectorAll('.add-unit').forEach(btn => {
    btn.addEventListener('click', () => {
      const sideElem = btn.parentNode;
      let type = 'land';
      if (sideElem.id.startsWith('sea')) type = 'sea';
      else if (sideElem.id.startsWith('air')) type = 'air';
      sideElem.querySelector('.units-list').appendChild(createUnitRow(type));
    });
  });

  // å…¨ã‚¿ãƒ–å·¦å³ã«åˆæœŸå¸«å›£ï¼‘ã¤ãšã¤è¿½åŠ 
  ['land', 'sea', 'air'].forEach(type => {
    addInitialUnits(document.getElementById(type + '-attacker'), type);
    addInitialUnits(document.getElementById(type + '-defender'), type);
  });

  // æˆ¦é—˜ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  window.simulateBattle = function(type) {
    const atkSide = document.getElementById(type + '-attacker');
    const defSide = document.getElementById(type + '-defender');
    const resultEl = document.getElementById('result-' + type);

    // æ”»æ’ƒå´åˆè¨ˆè¨ˆç®—
    let atkTotalAttack = 0;
    let atkTotalDefense = 0;
    let atkTotalCount = 0;

    const atkUnits = atkSide.querySelectorAll('.unit-row');
    let atkDesc = 'ã€æ”»æ’ƒå´ã€‘\n';
    atkUnits.forEach(unit => {
      const key = unit.querySelector('select').value;
      const count = parseInt(unit.querySelector('input').value) || 0;
      if (count < 1) return;
      const data = unitsData[type][key];
      atkDesc += `${data.name} x ${count}äºº\n`;
      atkTotalAttack += data.attack * count;
      atkTotalDefense += data.defense * count;
      atkTotalCount += count;
    });

    // é˜²å¾¡å´åˆè¨ˆè¨ˆç®—
    let defTotalAttack = 0;
    let defTotalDefense = 0;
    let defTotalCount = 0;

    const defUnits = defSide.querySelectorAll('.unit-row');
    let defDesc = 'ã€é˜²è¡›å´ã€‘\n';
    defUnits.forEach(unit => {
      const key = unit.querySelector('select').value;
      const count = parseInt(unit.querySelector('input').value) || 0;
      if (count < 1) return;
      const data = unitsData[type][key];
      defDesc += `${data.name} x ${count}äºº\n`;
      defTotalAttack += data.attack * count;
      defTotalDefense += data.defense * count;
      defTotalCount += count;
    });

    // æˆ¦é—˜è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰
    // å‹æ•—ã¯æ”»æ’ƒå´æ”»æ’ƒåŠ›vsé˜²å¾¡å´é˜²å¾¡åŠ›ã®æ¯”è¼ƒã§æ±ºå®š
    // æ­»äº¡è€…ã¯ä¹±æ•°ã§åŒæ–¹ãã‚Œãã‚Œæœ€å¤§5ï½15%ã®æå®³ç‡ã«å‹æ•—è£œæ­£ã‚’ã‹ã‘ã¦æ±ºå®š

    const atkPower = atkTotalAttack;
    const defPower = defTotalDefense;

    let outcome = '';
    if(atkPower > defPower) {
      outcome = 'âš”ï¸ æ”»æ’ƒå´ã®å‹åˆ©ï¼\n';
    } else {
      outcome = 'ğŸ›¡ï¸ é˜²è¡›å´ã®å‹åˆ©ï¼\n';
    }

    // æå®³ç‡ï¼ˆ%ï¼‰
    // å‹è€…ã¯ä½ã‚ã®æå®³(5%ã€œ10%)
    // æ•—è€…ã¯é«˜ã‚ã®æå®³(10%ã€œ15%)
    function getLosses(count, isWinner) {
      if(count === 0) return 0;
      let min = isWinner ? 0.05 : 0.10;
      let max = isWinner ? 0.10 : 0.15;
      let rate = min + Math.random() * (max - min);
      return Math.min(count, Math.floor(count * rate));
    }

    const atkWin = atkPower > defPower;
    const atkLoss = getLosses(atkTotalCount, atkWin);
    const defLoss = getLosses(defTotalCount, !atkWin);

    let resultText =
`${atkDesc}\n${defDesc}\n` +
`æ”»æ’ƒå´ æ”»æ’ƒåŠ›åˆè¨ˆ: ${atkPower}\né˜²è¡›å´ é˜²å¾¡åŠ›åˆè¨ˆ: ${defPower}\n\n` +
outcome +
`é˜²è¡›å´ æ­»äº¡è€…æ•°: ${atkLoss}\næ”»æ’ƒå´ æ­»äº¡è€…æ•°: ${defLoss}\n`;

    resultEl.textContent = resultText;
  };

})();
</script>

</body>
</html>
