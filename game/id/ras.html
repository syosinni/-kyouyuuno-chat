<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å…µå™¨ç ”ç©¶ã‚·ã‚¹ãƒ†ãƒ </title>
  <style>
    body { display:flex; height:100vh; margin:0; font-family:sans-serif; }
    #left, #right { flex:1; padding:10px; overflow:auto; border-right:1px solid #ccc; }
    #right { border:none; }
    h2 { margin-top:0; }
    input, button, select { margin:5px 0; padding:5px; width:100%; }
    .list { background:#f4f4f4; padding:5px; margin:5px 0; }
    #dayCounter { font-weight:bold; font-size:16px; }
  </style>
</head>
<body>
  <!-- å…µå™¨ç ”ç©¶ãƒ‘ãƒãƒ« -->
  <div id="left">
    <h2>ğŸ”§ å…µå™¨ç ”ç©¶</h2>
    <input type="text" id="weaponName" placeholder="å…µå™¨å">
    <input type="number" id="devDays" placeholder="é–‹ç™ºæ—¥æ•°">
    <button onclick="addWeapon()">å…µå™¨ã‚’è¿½åŠ </button>
    <button onclick="addNuke()">â˜¢ï¸ æ ¸å…µå™¨ã‚’è¿½åŠ </button>
    <button onclick="progressDay()">ğŸ“… 1æ—¥é€²è¡Œ</button>
    <p id="dayCounter">ç¾åœ¨ã®æ—¥æ•°: 0æ—¥</p>
    <button onclick="downloadWeapons()">ğŸ’¾ å…µå™¨JSONä¿å­˜</button>
    <input type="file" onchange="loadWeapons(event)">
    <div id="weaponList"></div>
  </div>

  <!-- ç ”ç©¶æ‰€ãƒ‘ãƒãƒ« -->
  <div id="right">
    <h2>ğŸ¢ ç ”ç©¶æ‰€</h2>
    <input type="text" id="labName" placeholder="ç ”ç©¶æ‰€å">
    <input type="number" id="labPoints" placeholder="ç ”ç©¶ãƒã‚¤ãƒ³ãƒˆ">
    <select id="labTarget">
      <option value="">ç ”ç©¶å¯¾è±¡ãªã—</option>
    </select>
    <button onclick="addLab()">ç ”ç©¶æ‰€ã‚’è¿½åŠ </button>
    <button onclick="downloadLabs()">ğŸ’¾ ç ”ç©¶æ‰€JSONä¿å­˜</button>
    <input type="file" onchange="loadLabs(event)">
    <div id="labList"></div>
  </div>

  <script>
    let weapons = [];
    let labs = [];
    let currentDay = 0;

    // === å…µå™¨ ===
    function addWeapon(){
      const name=document.getElementById("weaponName").value.trim();
      const days=parseInt(document.getElementById("devDays").value)||0;
      if(!name||days<=0){ alert("å…µå™¨åã¨æ—¥æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
      weapons.push({id:Date.now(), name, days, progress:0, complete:false});
      updateWeaponList();
      updateLabTargetOptions();
    }

    function addNuke(){
      weapons.push({id:Date.now(), name:"æ ¸å…µå™¨", days:180, progress:0, complete:false, nuke:true});
      updateWeaponList();
      updateLabTargetOptions();
    }

    function updateWeaponList(){
      const div=document.getElementById("weaponList");
      div.innerHTML=weapons.map(w=>{
        const status = w.complete ? "âœ… å®Œäº†" : `é€²æ—: ${w.progress}/${w.days}`;
        const special = w.nuke ? "â˜¢ï¸" : "";
        return `<div class="list"><b>${special}${w.name}</b><br>${status}</div>`;
      }).join("");
    }

    // === ç ”ç©¶æ‰€ ===
    function addLab(){
      const name=document.getElementById("labName").value.trim();
      const points=parseInt(document.getElementById("labPoints").value)||0;
      const target=document.getElementById("labTarget").value;
      if(!name||points<=0){ alert("ç ”ç©¶æ‰€åã¨ãƒã‚¤ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
      labs.push({id:Date.now(), name, points, target});
      updateLabList();
    }

    function updateLabList(){
      const div=document.getElementById("labList");
      div.innerHTML=labs.map(l=>{
        const targetName = weapons.find(w=>w.id==l.target)?.name || "ãªã—";
        return `<div class="list"><b>${l.name}</b><br>ç ”ç©¶ãƒã‚¤ãƒ³ãƒˆ: ${l.points}<br>ç ”ç©¶å¯¾è±¡: ${targetName}</div>`;
      }).join("");
    }

    function updateLabTargetOptions(){
      const select=document.getElementById("labTarget");
      const currentValue=select.value;
      select.innerHTML='<option value="">ç ”ç©¶å¯¾è±¡ãªã—</option>'+weapons.map(w=>`<option value="${w.id}">${w.name}</option>`).join("");
      select.value=currentValue;
    }

    // === é€²è¡Œ ===
    function progressDay(){
      currentDay++;
      document.getElementById("dayCounter").textContent=`ç¾åœ¨ã®æ—¥æ•°: ${currentDay}æ—¥`;

      labs.forEach(lab=>{
        if(lab.target){
          const weapon=weapons.find(w=>w.id==lab.target);
          if(weapon && !weapon.complete){
            weapon.progress += lab.points;
            if(weapon.progress >= weapon.days){
              weapon.progress = weapon.days;
              weapon.complete = true;
            }
          }
        }
      });

      updateWeaponList();
    }

    // === JSONä¿å­˜ ===
    function downloadWeapons(){
      const blob=new Blob([JSON.stringify({weapons},null,2)],{type:"application/json"});
      const link=document.createElement("a");
      link.href=URL.createObjectURL(blob);
      link.download="weapons.json";
      link.click();
    }

    function loadWeapons(event){
      const file=event.target.files[0]; if(!file)return;
      const reader=new FileReader();
      reader.onload=e=>{
        weapons=JSON.parse(e.target.result).weapons||[];
        updateWeaponList();
        updateLabTargetOptions();
      };
      reader.readAsText(file);
    }

    function downloadLabs(){
      const blob=new Blob([JSON.stringify({labs},null,2)],{type:"application/json"});
      const link=document.createElement("a");
      link.href=URL.createObjectURL(blob);
      link.download="labs.json";
      link.click();
    }

    function loadLabs(event){
      const file=event.target.files[0]; if(!file)return;
      const reader=new FileReader();
      reader.onload=e=>{
        labs=JSON.parse(e.target.result).labs||[];
        updateLabList();
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>
