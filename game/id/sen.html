<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ‹¡å¼µè­°ä¼šã‚·ã‚¹ãƒ†ãƒ </title>
  <style>
    body { font-family:sans-serif; padding:10px; }
    input, button, select { margin:5px; padding:5px; }
    #partyList, #billLog { background:#f4f4f4; padding:10px; margin:10px 0; max-height:200px; overflow:auto; }
  </style>
</head>
<body>
  <h1>ğŸ›ï¸ è­°ä¼šã‚·ã‚¹ãƒ†ãƒ </h1>

  <h2>å…šã‚’ä½œæˆ</h2>
  åå‰: <input type="text" id="partyName">
  å…šé¦–: <input type="text" id="leader">
  è­°å¸­æ•°: <input type="number" id="seats" value="10">
  æ”¯æŒç‡(0-100): <input type="number" id="support" value="50">
  ç‹¬è£åº¦(0-100): <input type="number" id="dict" value="50">
  çµŒæ¸ˆæ”¿ç­–(å·¦-å³ 0-100): <input type="number" id="eco" value="50">
  <button onclick="addParty()">å…šã‚’è¿½åŠ </button>

  <div id="partyList"></div>

  <h2>æ³•æ¡ˆæå‡º</h2>
  æ³•æ¡ˆå: <input type="text" id="billName">
  ã‚«ãƒ†ã‚´ãƒª: 
  <select id="billType">
    <option value="è»äº‹">è»äº‹</option>
    <option value="çµŒæ¸ˆ">çµŒæ¸ˆ</option>
    <option value="ç¤¾ä¼š">ç¤¾ä¼š</option>
  </select>
  ç‹¬è£åº¦: <input type="number" id="billDict" value="50">
  è³‡é‡‘ä½¿ç”¨åº¦: <input type="number" id="billMoney" value="50">
  <button onclick="voteBill()">æŠ•ç¥¨</button>

  <h3>æ³•æ¡ˆå±¥æ­´</h3>
  <div id="billLog"></div>

  <h2>è­°ä¼šç®¡ç†</h2>
  <button onclick="dissolve()">è­°ä¼šè§£æ•£</button>
  <button onclick="election()">é¸æŒ™</button>

  <h2>ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
  <button onclick="saveJSON()">JSONä¿å­˜</button>
  <input type="file" id="fileInput" onchange="loadJSON()">

  <script>
    let parties = [];
    let bills = [];

    function addParty(){
      const name=document.getElementById("partyName").value;
      const leader=document.getElementById("leader").value;
      const seats=parseInt(document.getElementById("seats").value)||0;
      const support=parseInt(document.getElementById("support").value)||50;
      const dict=parseInt(document.getElementById("dict").value)||50;
      const eco=parseInt(document.getElementById("eco").value)||50;
      parties.push({name, leader, seats, support, dict, eco});
      updatePartyList();
    }

    function updatePartyList(){
      document.getElementById("partyList").innerHTML = parties.map(p=>
        `<div><b>${p.name}</b> (${p.leader}) è­°å¸­:${p.seats} æ”¯æŒç‡:${p.support}% ç‹¬è£åº¦:${p.dict} çµŒæ¸ˆ:${p.eco}</div>`
      ).join("");
    }

    function voteBill(){
      const bill=document.getElementById("billName").value;
      const type=document.getElementById("billType").value;
      const billDict=parseInt(document.getElementById("billDict").value)||50;
      const billMoney=parseInt(document.getElementById("billMoney").value)||50;

      let totalSeats=parties.reduce((sum,p)=>sum+p.seats,0);
      let approve=0;
      parties.forEach(p=>{
        let score=100-Math.abs(p.dict-billDict);
        if(score > 50) approve+=p.seats;
      });
      let result = approve > totalSeats/2 ? "å¯æ±º" : "å¦æ±º";
      bills.unshift({name:bill, type, result});
      renderBills();
    }

    function renderBills(){
      document.getElementById("billLog").innerHTML = bills.map(b=>
        `<div>[${b.type}] æ³•æ¡ˆã€Œ${b.name}ã€ â†’ ${b.result}</div>`
      ).join("");
    }

    function dissolve(){
      parties.forEach(p=>p.seats=Math.floor(p.seats*0.5));
      updatePartyList();
      alert("è­°ä¼šã‚’è§£æ•£ã—ã¾ã—ãŸã€‚æ¬¡ã®é¸æŒ™ã§å†ç·¨ã•ã‚Œã¾ã™ã€‚");
    }

    function election(){
      parties.forEach(p=>{
        let variation=Math.floor((p.support-50)/10);
        p.seats=Math.max(1, Math.floor(Math.random()*20)+variation);
      });
      updatePartyList();
      alert("é¸æŒ™ãŒè¡Œã‚ã‚Œã¾ã—ãŸã€‚è­°å¸­æ•°ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚");
    }

    function saveJSON(){
      const data = {parties, bills};
      const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href=url;
      a.download="parliament.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function loadJSON(){
      const file=document.getElementById("fileInput").files[0];
      const reader=new FileReader();
      reader.onload=function(e){
        const data=JSON.parse(e.target.result);
        parties=data.parties||[];
        bills=data.bills||[];
        updatePartyList();
        renderBills();
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>
