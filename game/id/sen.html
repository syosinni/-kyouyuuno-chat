<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>é«˜åº¦è­°ä¼šã‚·ã‚¹ãƒ†ãƒ v2</title>
  <style>
    body { font-family:sans-serif; padding:10px; }
    input, button, select { margin:5px; padding:5px; }
    #partyList, #billLog, #parliamentList { background:#f4f4f4; padding:10px; margin:10px 0; max-height:200px; overflow:auto; }
    .ruling { color: red; font-weight:bold; }
  </style>
</head>
<body>
  <h1>ğŸ›ï¸ é«˜åº¦è­°ä¼šã‚·ã‚¹ãƒ†ãƒ v2</h1>

  <h2>è­°ä¼šç®¡ç†</h2>
  è­°ä¼šå: <input type="text" id="parliamentName">
  æœ€å¤§è­°å¸­æ•°: <input type="number" id="maxSeats" value="100">
  <button onclick="createParliament()">è­°ä¼šã‚’è¿½åŠ </button>
  <button onclick="deleteParliament()">é¸æŠè­°ä¼šã‚’å‰Šé™¤</button>
  <div id="parliamentList"></div>

  <h2>å…šä½œæˆï¼ˆé¸æŠä¸­ã®è­°ä¼šï¼‰</h2>
  åå‰: <input type="text" id="partyName">
  å…šé¦–: <input type="text" id="leader">
  è­°å¸­æ•°: <input type="number" id="seats" value="10">
  <br>
  è»æ‹¡: <input type="number" id="military" value="50"> 
  åŸå­åŠ›: <input type="number" id="nuclear" value="50">
  å¤–äº¤: <input type="number" id="diplomacy" value="50">
  ç¦ç¥‰: <input type="number" id="welfare" value="50">
  ç¨åˆ¶: <input type="number" id="tax" value="50">
  å®—æ•™: <input type="number" id="religion" value="50">
  ç’°å¢ƒ: <input type="number" id="environment" value="50">
  ç”£æ¥­: <input type="number" id="industry" value="50">
  ç¤¾ä¼šè‡ªç”±åº¦: <input type="number" id="social" value="50">
  çµŒæ¸ˆè‡ªç”±åº¦: <input type="number" id="eco" value="50">
  <br>
  <button onclick="addParty()">å…šã‚’è¿½åŠ </button>
  <button onclick="deleteParty()">é¸æŠã—ãŸå…šã‚’å‰Šé™¤</button>

  <div id="partyList"></div>

  <h2>æ³•æ¡ˆæå‡º</h2>
  æ³•æ¡ˆå: <input type="text" id="billName">
  ã‚«ãƒ†ã‚´ãƒª:
  <select id="billType"></select>
  æ”¿ç­–å€¤(0-100): <input type="number" id="billValue" value="50">
  <button onclick="voteBill()">æŠ•ç¥¨</button>

  <h3>æ³•æ¡ˆå±¥æ­´</h3>
  <div id="billLog"></div>

  <h2>è­°ä¼šæ“ä½œ</h2>
  <button onclick="election()">é¸æŒ™</button>

  <h2>ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
  <button onclick="saveJSON()">JSONä¿å­˜</button>
  <input type="file" id="fileInput" onchange="loadJSON()">

  <script>
    const billCategories = ["è»äº‹","é˜²è¡›","å¤–äº¤","çµŒæ¸ˆ","ç¤¾ä¼š","ç¦ç¥‰","æ•™è‚²","åŒ»ç™‚","åŸå­åŠ›","ç’°å¢ƒ",
    "ç§‘å­¦æŠ€è¡“","ã‚¨ãƒãƒ«ã‚®ãƒ¼","è¾²æ¥­","ç”£æ¥­","äº¤é€š","é€šä¿¡","åŠ´åƒ","ç§»æ°‘","æ²»å®‰","å®—æ•™",
    "æ–‡åŒ–","å®‡å®™é–‹ç™º","ã‚µã‚¤ãƒãƒ¼é˜²è¡›","é‡‘è","ç¨åˆ¶","å¸æ³•","åœ°æ–¹è‡ªæ²»","éƒ½å¸‚è¨ˆç”»","ç½å®³å¯¾ç­–","ã‚¤ãƒ³ãƒ•ãƒ©"];

    billCategories.forEach(c=>{
      const opt=document.createElement("option");
      opt.value=c; opt.textContent=c;
      document.getElementById("billType").appendChild(opt);
    });

    let parliaments = [];
    let currentParliament = null;

    function createParliament(){
      const name = document.getElementById("parliamentName").value;
      const maxSeats = parseInt(document.getElementById("maxSeats").value)||100;
      if(!name)return;
      parliaments.push({name, maxSeats, parties:[], bills:[], rulingParty:null});
      currentParliament = parliaments[parliaments.length-1];
      updateParliamentList();
    }

    function updateParliamentList(){
      document.getElementById("parliamentList").innerHTML = parliaments.map((p,i)=>
        `<div onclick="selectParliament(${i})" style="cursor:pointer;${currentParliament===parliaments[i]?'background:#ddd;':''}">
          ${p.name} (æœ€å¤§è­°å¸­:${p.maxSeats})</div>`
      ).join("");
      updatePartyList();
      renderBills();
    }

    function selectParliament(i){
      currentParliament = parliaments[i];
      updateParliamentList();
    }

    function deleteParliament(){
      if(!currentParliament)return alert("è­°ä¼šã‚’é¸æŠã—ã¦ãã ã•ã„");
      const idx=parliaments.indexOf(currentParliament);
      parliaments.splice(idx,1);
      currentParliament = parliaments[0]||null;
      updateParliamentList();
    }

    function addParty(){
      if(!currentParliament)return alert("è­°ä¼šã‚’é¸æŠã—ã¦ãã ã•ã„");
      const name=document.getElementById("partyName").value;
      const leader=document.getElementById("leader").value;
      const seats=parseInt(document.getElementById("seats").value)||0;
      const p = {
        name, leader, seats,
        military:+document.getElementById("military").value,
        nuclear:+document.getElementById("nuclear").value,
        diplomacy:+document.getElementById("diplomacy").value,
        welfare:+document.getElementById("welfare").value,
        tax:+document.getElementById("tax").value,
        religion:+document.getElementById("religion").value,
        environment:+document.getElementById("environment").value,
        industry:+document.getElementById("industry").value,
        social:+document.getElementById("social").value,
        eco:+document.getElementById("eco").value
      };
      currentParliament.parties.push(p);
      updatePartyList();
    }

    function updatePartyList(){
      if(!currentParliament){document.getElementById("partyList").innerHTML="";return;}
      document.getElementById("partyList").innerHTML = currentParliament.parties.map((p,i)=>
        `<div><input type="radio" name="partySelect" value="${i}">
        <b class="${currentParliament.rulingParty===p.name?'ruling':''}">${p.name}</b>(${p.leader}) è­°å¸­:${p.seats}</div>`
      ).join("");
    }

    function deleteParty(){
      if(!currentParliament)return;
      const idx = document.querySelector('input[name="partySelect"]:checked');
      if(idx){
        currentParliament.parties.splice(idx.value,1);
        updatePartyList();
      }
    }

    function voteBill(){
      if(!currentParliament)return alert("è­°ä¼šã‚’é¸æŠã—ã¦ãã ã•ã„");
      const bill=document.getElementById("billName").value;
      const type=document.getElementById("billType").value;
      const value=parseInt(document.getElementById("billValue").value)||50;

      let totalSeats=currentParliament.parties.reduce((s,p)=>s+p.seats,0);
      let approve=0;
      currentParliament.parties.forEach(p=>{
        let policy=50;
        if(type==="è»äº‹")policy=p.military;
        else if(type==="åŸå­åŠ›")policy=p.nuclear;
        else if(type==="å¤–äº¤")policy=p.diplomacy;
        else if(type==="ç¦ç¥‰")policy=p.welfare;
        else if(type==="ç¨åˆ¶")policy=p.tax;
        else if(type==="å®—æ•™")policy=p.religion;
        else if(type==="ç’°å¢ƒ")policy=p.environment;
        else if(type==="ç”£æ¥­")policy=p.industry;
        else if(type==="ç¤¾ä¼š")policy=p.social;
        else if(type==="çµŒæ¸ˆ")policy=p.eco;
        let score=100-Math.abs(policy-value);
        if(score>50)approve+=p.seats;
      });

      let result = approve > totalSeats/2 ? "å¯æ±º" : "å¦æ±º";
      currentParliament.bills.unshift({name:bill, type, value, result});
      renderBills();
    }

    function renderBills(){
      if(!currentParliament){document.getElementById("billLog").innerHTML="";return;}
      document.getElementById("billLog").innerHTML = currentParliament.bills.map(b=>
        `<div>[${b.type}] ${b.name} â†’ ${b.result}</div>`
      ).join("");
    }

    function election(){
      if(!currentParliament)return;
      const max = currentParliament.maxSeats;
      let total = 0;
      currentParliament.parties.forEach(p=>{
        p.seats=Math.max(1,Math.floor(Math.random()*max/2));
        total+=p.seats;
      });
      if(total>max){
        const ratio = max/total;
        currentParliament.parties.forEach(p=>p.seats=Math.floor(p.seats*ratio));
      }
      let ruling = currentParliament.parties.reduce((a,b)=>a.seats>b.seats?a:b,null);
      currentParliament.rulingParty=ruling? ruling.name : null;
      updatePartyList();
      alert("é¸æŒ™å®Œäº†ã€‚ä¸å…š: "+(ruling? ruling.name : "ãªã—"));
    }

    function saveJSON(){
      const data = {parliaments};
      const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href=url;
      a.download="parliament_system_v2.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function loadJSON(){
      const file=document.getElementById("fileInput").files[0];
      const reader=new FileReader();
      reader.onload=function(e){
        const data=JSON.parse(e.target.result);
        parliaments=data.parliaments||[];
        currentParliament=parliaments[0]||null;
        updateParliamentList();
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>
