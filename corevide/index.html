<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CoreVIDE</title>
<style>
  body {
    background: linear-gradient(135deg, #203a43 60%, #ff0000 120%);
    font-family: 'Segoe UI',Roboto,Arial,sans-serif;
    color: #eee;
    margin: 0;
  }
  header {
    background: #ff0000;
    padding: 18px 0;
    text-align: center;
    font-size: 2rem;
    font-weight: bold;
    letter-spacing: .1em;
    color: #fff;
    box-shadow: 0 4px 15px rgba(255,0,0,0.4);
  }
  main {
    max-width: 900px;
    margin: 30px auto;
    padding: 0 12px 40px;
  }
  .section {
    margin-bottom: 30px;
    background: rgba(255,0,0,0.12);
    border-radius: 16px;
    box-shadow: 0 2px 12px rgba(255,0,0,0.18);
    padding: 18px 20px;
  }
  .section h2{
    font-size: 1.22rem;
    color: #fff3f3;
    margin-bottom: 8px;
  }
  .section input[type="file"]{
    font-size:1rem;
    color:#fff;
    padding:6px 6px 6px 0;
    background: transparent;
  }
  .section input[type="text"]{
    font-size:1rem;
    padding:8px;
    border-radius:6px;
    border:none;
    background:rgba(255,255,255,.07);
    color:#fff;
    margin-right:12px;
    outline: none;
  }
  .section button {
    font-size:1rem;
    background:#ff0000;
    color:#fff;
    border-radius:7px;
    border:none;
    padding: 8px 20px;
    font-weight: bold;
    cursor:pointer;
    box-shadow:0 4px 8px rgba(255,0,0,0.12);
    transition:background 0.2s,transform .13s;
  }
  .section button:hover {
    background:#c90000;
    transform:scale(1.06);
  }
  .share-area {
    margin-bottom:30px;
    background: rgba(0,0,0,.17);
    border-radius:13px;
    box-shadow:0 2px 10px rgba(255,0,0,0.08);
    padding:16px 18px;
  }
  .share-area textarea {
    width:100%; min-height:80px;
    font-family:Consolas,monospace;
    font-size:.95em;
    border-radius:7px;
    border:none;
    padding:8px;
    margin-bottom:7px;
    background:#181818;
    color:#ffaaaa;
    resize:vertical;
  }
  .share-area button {
    background:#0099ff;
    color:#fff;
    padding:6px 11px;
    border-radius:6px;
    border:none;
    font-size:.97rem;
    font-weight:bold;
    margin-right:6px;
    transition:.18s;
    cursor:pointer;
  }
  .share-area button:hover {
    background:#83d6ff;
    color:#023;
  }
  .videos {
    display: grid;
    gap: 32px;
    grid-template-columns: repeat(auto-fill,minmax(340px,1fr));
  }
  .card {
    background:rgba(30,30,30,0.93);
    border-radius:14px;
    overflow:hidden;
    box-shadow:0 0 20px rgba(255,0,0,.13),0 8px 22px rgba(0,0,0,.67);
    transition:.3s;
    position:relative;
    display:flex;
    flex-direction:column;
  }
  .card:hover {
    transform:translateY(-6px) scale(1.02);
    box-shadow:0 0 36px rgba(255,0,0,.23),0 8px 32px rgba(0,0,0,.79);
  }
  .card video {
    width:100%;
    aspect-ratio:16/9;
    background:#000;
    display:block;
    border-bottom:1px solid #333;
  }
  .infoArea {
    padding:14px 16px 10px;
    flex-grow:1;
    display:flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .infoTitle {
    color:#ffabab;
    font-weight:700;
    font-size:1.08rem;
    word-break:break-all;
    margin-bottom:7px;
  }
  .infoDesc {
    color:#e0e0e0;
    font-size:.94rem;
    margin-bottom:8px;
  }
  .infoDate { color: #aaa; font-size: .83rem; }
  .del-btn {
    position:absolute;
    top:14px; right:14px;
    background:rgba(255,0,0,.90);
    border:none;
    color:#fff;
    border-radius:50%;
    font-size:1.15rem;
    width:28px; height:28px;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 0 7px rgba(255,0,0,0.19);
    opacity:0;
    transition:opacity .2s;
    z-index:2;
  }
  .card:hover .del-btn { opacity:1;}
  /* コメント部分 */
  .comments {
    margin:12px 0 5px;
    background:rgba(255,255,255,.04);
    border-radius:7px;
    padding:8px;
    box-shadow:0 1px 9px rgba(255,0,0,.06);
    font-size:.96rem;
  }
  .comment {
    margin-bottom:8px;
    font-size:.97rem;
    color:#fff;
    padding:5px 0 5px 0;
    border-bottom: 1px solid #333;
  }
  .comment:last-child { border-bottom:none;}
  .comment-user {
    color:#ff7979;
    font-size:0.89rem;
    padding-right:6px;
    font-style:italic;
  }
  .comment-date {
    color:#aaa;
    font-size:0.81rem;
    margin-left:7px;
  }
  .comment-input-row {
    margin-top:7px;
    display:flex;
    gap:8px;
    align-items: center;
  }
  .comment-input {
    flex:1;
    font-size:.97rem;
    border-radius:6px;
    border:none;
    background:rgba(255,255,255,.09);
    color:#fff;
    padding:7px 8px;
    outline:none;
  }
  .comment-btn {
    background:#ff2222;
    border:none;
    color:#fff;
    border-radius:8px;
    font-size:0.97rem;
    padding:7px 17px;
    font-weight:bold;
    box-shadow:0 3px 7px rgba(255,0,0,.22);
    cursor:pointer;
    transition:.15s;
  }
  .comment-btn:hover { background:#d70000;}
  @media (max-width:600px){
    .videos{ grid-template-columns:1fr;}
    .card video { height:170px;}
    .share-area textarea {min-height:60px;}
  }
</style>
</head>
<body>
<header>CoreVIDE</header>
<main>
  <!-- ファイル動画追加 -->
  <section class="section">
    <h2>動画ファイルを追加</h2>
    <form id="fileForm" onsubmit="event.preventDefault();addFile();">
      <input id="videoFileInput" type="file" accept="video/mp4,video/webm,video/ogg" />
      <input id="fileCommentInput" type="text" placeholder="動画のタイトル/説明">
      <button id="addFileBtn">ファイル追加</button>
    </form>
    <p style="font-size:.89rem;color:#faa;margin-top:8px;">※ 4MB以下の動画のみ（localStorage制限）。</p>
  </section>

  <!-- 共有機能 -->
  <section class="share-area">
    <h2 style="font-size:1.1rem;color:#88e;">共有・インポート/エクスポート</h2>
    <textarea id="jsonArea" placeholder="ここにJSONをコピー/貼付け"></textarea><br>
    <button onclick="importJson();">インポート</button>
    <button onclick="exportJson();">エクスポート</button>
    <span id="shareMsg" style="font-size:.95em;color:#8fc;margin-left:10px;"></span>
  </section>

  <section class="videos" id="videoList"></section>
</main>
<script>
const STORAGE_KEY = "corevide_myvideos";


function loadVideos(){
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
  catch { return []; }
}
function saveVideos(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}
function fmtDate(date){
  let y=date.getFullYear(),m=String(date.getMonth()+1).padStart(2,"0"),d=String(date.getDate()).padStart(2,"0");
  return `${y}-${m}-${d}`;
}
function addFile(){
  const input=document.getElementById("videoFileInput");
  if (!input.files[0]) return alert("ファイルを選択してください");
  const file=input.files[0];
  if(file.size>4*1024*1024) return alert("4MB以下の動画のみ保存できます。");
  const reader=new FileReader();
  reader.onloadend=function(e){
    const data = e.target.result;
    let arr=loadVideos();
    arr.unshift({
      file: { data, name:file.name },
      title: document.getElementById("fileCommentInput").value,
      date: fmtDate(new Date()),
      comments:[]
    });
    saveVideos(arr);
    input.value="";
    document.getElementById("fileCommentInput").value="";
    render();
    showShareMsg('動画を追加しました。');
  };
  reader.readAsDataURL(file);
}

function addComment(idx){
  const box=document.getElementById("commentInput"+idx);
  const val=box.value.trim();
  if(!val) return;
  let arr=loadVideos();
  arr[idx].comments.push({
    user:"匿名",
    text:val,
    date: fmtDate(new Date())
  });
  saveVideos(arr);
  box.value="";
  render();
}

function createCard(video,idx){
  const card=document.createElement("article");
  card.className="card";
  const vid=document.createElement("video");
  vid.src=video.file.data;
  vid.controls=true;
  vid.preload="metadata";
  card.appendChild(vid);

  const infoArea=document.createElement("div");
  infoArea.className="infoArea";
  const titleSpan=document.createElement("span");
  titleSpan.className="infoTitle";
  titleSpan.textContent=video.title?video.title:"(タイトルなし)";
  infoArea.appendChild(titleSpan);
  const fnSpan=document.createElement("div");
  fnSpan.className="infoDesc";
  fnSpan.textContent="ファイル名: "+(video.file.name||"no name");
  infoArea.appendChild(fnSpan);
  const dt=document.createElement("div");
  dt.className="infoDate";
  dt.textContent="追加日: "+video.date;
  infoArea.appendChild(dt);
  card.appendChild(infoArea);

  const commentsBox=document.createElement("div");
  commentsBox.className="comments";
  if(video.comments&&video.comments.length>0){
    video.comments.forEach(comment=>{
      const comDiv=document.createElement("div");
      comDiv.className="comment";
      comDiv.innerHTML=`<span class="comment-user">${comment.user}：</span>${comment.text} <span class="comment-date">${comment.date}</span>`;
      commentsBox.appendChild(comDiv);
    });
  }
  card.appendChild(commentsBox);

  const inpBox=document.createElement("div");
  inpBox.className="comment-input-row";
  const inp=document.createElement("input");
  inp.className="comment-input";
  inp.id="commentInput"+idx;
  inp.placeholder="コメント・批評を書く";
  const btn=document.createElement("button");
  btn.className="comment-btn";
  btn.textContent="送信";
  btn.onclick=()=>addComment(idx);
  inpBox.append(inp,btn);
  card.appendChild(inpBox);

  const del=document.createElement("button");
  del.className="del-btn";
  del.type="button";
  del.textContent="×";
  del.title="動画を削除";
  del.onclick=()=>{
    if(confirm("削除しますか？")) {
      let arr=loadVideos();
      arr.splice(idx,1);
      saveVideos(arr);
      render();
      showShareMsg('動画を削除しました。');
    }
  };
  card.appendChild(del);

  return card;
}

function render(){
  const container=document.getElementById("videoList");
  container.innerHTML="";
  const arr=loadVideos();
  if(arr.length==0){
    const msg=document.createElement("p");
    msg.textContent="動画ファイルはありません。追加してください。";
    msg.style.textAlign="center";
    msg.style.opacity=".7";
    container.appendChild(msg);
    return;
  }
  arr.forEach((video,idx)=>{
    container.appendChild(createCard(video,idx));
  });
}

// 共有・エクスポート(JSONコピー)機能
function exportJson(){
  const arr=loadVideos();
  const jsonStr=JSON.stringify(arr,null,2);
  document.getElementById('jsonArea').value=jsonStr;
  if(window.navigator.clipboard){
    window.navigator.clipboard.writeText(jsonStr).then(()=>{
      showShareMsg("クリップボードにコピーしました！");
    });
  }else{
    showShareMsg("JSONを表示しました。手動でコピーできます。");
  }
}
// インポート(JSON貼付け)機能
function importJson(){
  let txt=document.getElementById('jsonArea').value.trim();
  if(!txt) return showShareMsg("JSONテキストを貼付けてください");
  try{
    let obj=JSON.parse(txt);
    if(!Array.isArray(obj)) throw "形式エラー";
    saveVideos(obj);
    render();
    showShareMsg("インポート完了しました！");
  }catch(e){
    showShareMsg("インポート失敗。JSONの形式を確認してください。");
  }
}
function showShareMsg(msg){
  const el=document.getElementById("shareMsg");
  el.textContent=msg;
  setTimeout(()=>{el.textContent="";},2500);
}
document.getElementById("addFileBtn").onclick=addFile;
render();
</script>
</body>
</html>
